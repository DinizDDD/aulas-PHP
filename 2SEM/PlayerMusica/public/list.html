<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Músicas</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-800 text-white p-8">
    <div class="container mx-auto max-w-4xl">
        <h1 class="text-4xl font-bold text-center text-teal-400 mb-8">Minhas Músicas</h1>
    
        <div class="container mx-auto max-w-4xl">
            <div class="bg-gray-700 p-4 rounded-lg shadow-lg mb-8 flex items-center justify-between">
                <audio id="audio-player" src="" class="hidden"></audio>
                <div id="player-info" class="text-sm">
                    <span class="font-bold" id="player-title">Nenhuma música selecionada</span>
                    <span class="text-gray-400" id="player-artist"></span>
                </div>
                <div class="flex items-center">
                    <button id="play-button" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"></path></svg>
                    </button>
                    <button id="pause-button" class="hidden bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full transition-colors duration-200">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7v6l5-3-5-3z"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        <div class="bg-gray-700 p-6 rounded-lg shadow-lg">
            <table class="w-full text-left table-auto">
                <thead>
                    <tr class="text-gray-400">
                        <th class="p-3 font-semibold">Título</th>
                        <th class="p-3 font-semibold">Artista</th>
                        <th class="p-3 font-semibold">Álbum</th>
                    </tr>
                </thead>
                <tbody id="songs-table-body">
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        const audioPlayer = document.getElementById('audio-player');
        const playButton = document.getElementById('play-button');
        const pauseButton = document.getElementById('pause-button');
        const playerTitle = document.getElementById('player-title');
        const playerArtist = document.getElementById('player-artist');

        let allSongs = []; // Variável para armazenar todas as músicas
        let currentSongIndex = -1; // -1 indica que nenhuma música está tocando

        async function fetchSongs() {
            const response = await fetch('http://localhost/aulas-PHP/2SEM/PlyerMusica/src/list_songs.php');
            const result = await response.json();
            const tableBody = document.getElementById('songs-table-body');

            tableBody.innerHTML = '';

            if (result.status === 'sucesso' && result.data.length > 0) {
                result.data.forEach(song => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-600 hover:bg-gray-600';
                    row.innerHTML = `
                    <td class="p-3">${song.titulo}</td>
                    <td class="p-3">${song.artista}</td>
                    <td class="p-3">${song.album || 'N/A'}</td>
                    <td class="p-3">
                        <button onclick="editSong(${song.id})" class="bg-blue-500 hover:bg-blue-600 text-white fontbold py-1 px-2 rounded text-xs transition-colors duration-200">Editar</button>
                        
                        <button onclick="deleteSong(${song.id})" class="bg-red-500 hover:bg-red-600 text-white fontbold py-1 px-2 rounded text-xs transition-colors duration-200 ml-2">Excluir</button>
                    </td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                tableBody.innerHTML = '<tr><td colspan="4" class="text-center p-4 text-gray-500">Nenhuma música encontrada.</td></tr>';
                }
            }

            async function playSong(id) {
                const song = allSongs.find(s => s.id === id); // Encontra a música pelo ID
                if (song) {
                    // Define a URL do arquivo de áudio
                    audioPlayer.src = `../music_files/${song.caminho_arquivo}`;
                    // Toca a música
                    audioPlayer.play();

                    // Atualiza as informações exibidas no player
                    playerTitle.textContent = song.titulo;
                    playerArtist.textContent = `- ${song.artista}`;
                    // Mostra o botão de Pause e esconde o de Play
                    playButton.classList.add('hidden');
                    pauseButton.classList.remove('hidden');
                }
            }

            function nextSong() {
                if (allSongs.length === 0) return;
                currentSongIndex = (currentSongIndex + 1) % allSongs.length;
                playSong(allSongs[currentSongIndex].id);
            }


            function pauseSong() {
                audioPlayer.pause();
                playButton.classList.remove('hidden');
                pauseButton.classList.add('hidden');
            }

            function prevSong() {
                if (allSongs.length === 0) return;
                currentSongIndex = (currentSongIndex - 1 + allSongs.length) % allSongs.length;
                playSong(allSongs[currentSongIndex].id);
            }

            // ... Event listeners para play, pause, next e prev...
            document.getElementById('next-button').addEventListener('click', nextSong);
            document.getElementById('prev-button').addEventListener('click', prevSong);

            // Conecta os botões de play e pause com as funções
            playButton.addEventListener('click', () => {
                audioPlayer.play();
                playButton.classList.add('hidden');
                pauseButton.classList.remove('hidden');
            });

            pauseButton.addEventListener('click', pauseSong);

            async function deleteSong(id) {
                if (!confirm('Tem certeza que deseja excluir esta música?')) {
                    return;
                }

                const response = await fetch(`http://localhost/aulas-PHP/2SEM/PlyerMusica/src/delete_song.php?id=${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();
                alert(result.mensagem);
                fetchSongs(); // Recarrega a lista
            }

            async function editSong(id) {
                const response = await fetch(`http://localhost/aulas-PHP/2SEM/PlyerMusica/src/get_song.php?id=${id}`);
                const result = await response.json();

                if (result.status === 'sucesso') {
                    const song = result.data;
                    // Agora, você pode usar os dados da variável 'song' para preencher o formulário
                    document.getElementById('edit-titulo').value = song.titulo;
                    document.getElementById('edit-artista').value = song.artista;
                    // ... e assim por diante
                } else {
                    alert(result.mensagem);
                }
            }

            document.addEventListener('DOMContentLoaded', fetchSongs);
    </script>
</body>
</html>
